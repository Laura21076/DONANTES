<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    script-src 'self' https: chrome-extension:; 
    style-src 'self' 'unsafe-inline' https:; 
    font-src 'self' https:; 
    img-src 'self' data: https: blob: gs:; 
    connect-src 'self' http: https: ws: wss: gs:; 
    default-src 'self' https:;">
  <title>Perfil | Donantes</title>
  <link rel="icon" href="../assets/logo.ico" type="image/x-icon">
  <link rel="shortcut icon" href="../assets/logo.ico" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Moirai+One&family=Rubik:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="../src/styles/styles.css">
  <link rel="stylesheet" href="../src/styles/donationcenter-profile.css">
</head>
  <script src="sw-register.js"></script>
  <script type="module" src="../src/utils/notifications-init.js"></script>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg custom-navbar fixed-top" style="z-index: 1030;">
    <div class="container">
      <div class="d-flex align-items-center">
        <button id="backToDonationsBtn" class="btn btn-link text-white me-3 p-0" style="border: none; background: none; font-size: 1.2rem; text-decoration: none;" title="Volver a Donaciones">
          <i class="fas fa-arrow-left"></i>
        </button>
        <a class="navbar-brand fw-bold text-white profile-navbar-brand" href="donationcenter.html">
          <i class="fas fa-heart heart-icon"></i>DONANTES
        </a>
      </div>

    </div>
  </nav>

  <!-- Spacer for fixed navbar -->
  <div style="height: 80px;"></div>

  <!-- Loader de perfil -->
  <div id="profileLoader" class="d-flex justify-content-center align-items-center" style="min-height: 300px;">
    <div class="spinner-border text-purple" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Cargando perfil...</span>
    </div>
  </div>

  <!-- Profile Container -->
  <div class="container" id="profileContainer" style="display: none;">
    <div class="profile-container">
      <!-- Header -->
      <div class="profile-header">
        <div class="profile-photo-container">
          <div id="profilePhotoDisplay" class="profile-photo">
            <i class="fas fa-user-circle"></i>
          </div>
          <div id="profilePhotoOverlay" class="profile-photo-overlay">
            <i class="fas fa-camera fa-2x text-white"></i>
          </div>
          <input type="file" id="photoUpload" accept="image/*" class="hidden-file-input">
        </div>
        <div class="d-flex align-items-center mb-2">
          <span id="profileDisplayName" class="fw-bold me-2">Mi Perfil</span>
          <span id="mfaStatusIcon" title="Autenticación en dos pasos activa" style="color: #A992D8; font-size: 1.5rem; display: none;">
            <i class="fas fa-shield-alt"></i>
          </span>
        </div>
        <p class="mb-0 profile-display-email" id="profileDisplayEmail">Actualiza tu información personal</p>
      </div>

      <!-- Body -->
      <div class="profile-body">

    <form id="profileForm">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label" for="firstName">Nombre</label>
          <input type="text" id="firstName" name="firstName" class="form-control" placeholder="Nombre" required autocomplete="given-name">
        </div>
        <div class="col-md-6">
          <label class="form-label" for="lastName">Apellido</label>
          <input type="text" id="lastName" name="lastName" class="form-control" placeholder="Apellido" required autocomplete="family-name">
        </div>

        <div class="col-md-12">
          <label class="form-label" for="email">Correo electrónico</label>
          <input type="email" id="email" name="email" class="form-control" placeholder="correo@ejemplo.com" required disabled autocomplete="email">
          <small class="text-muted">Para cambiar tu email, usa la opción en configuración de seguridad</small>
        </div>

        <div class="col-md-12">
          <label class="form-label" for="phone">Teléfono</label>
          <input type="tel" id="phone" name="phone" class="form-control" placeholder="(000) 000-0000" autocomplete="tel">
        </div>

        <div class="col-md-12">
          <label class="form-label" for="address">Dirección</label>
          <input type="text" id="address" name="address" class="form-control" placeholder="Calle, número, colonia" autocomplete="street-address">
        </div>

        <div class="col-md-6">
          <label class="form-label" for="state">Estado</label>
          <select id="state" name="state" class="form-control" autocomplete="address-level1">
            <option value="">Seleccionar estado...</option>
            <option value="Aguascalientes">Aguascalientes</option>
            <option value="Baja California">Baja California</option>
            <option value="Baja California Sur">Baja California Sur</option>
            <option value="Campeche">Campeche</option>
            <option value="Chiapas">Chiapas</option>
            <option value="Chihuahua">Chihuahua</option>
            <option value="Ciudad de México">Ciudad de México</option>
            <option value="Coahuila">Coahuila</option>
            <option value="Colima">Colima</option>
            <option value="Durango">Durango</option>
            <option value="Guanajuato">Guanajuato</option>
            <option value="Guerrero">Guerrero</option>
            <option value="Hidalgo">Hidalgo</option>
            <option value="Jalisco">Jalisco</option>
            <option value="México">México</option>
            <option value="Michoacán">Michoacán</option>
            <option value="Morelos">Morelos</option>
            <option value="Nayarit">Nayarit</option>
            <option value="Nuevo León">Nuevo León</option>
            <option value="Oaxaca">Oaxaca</option>
            <option value="Puebla">Puebla</option>
            <option value="Querétaro">Querétaro</option>
            <option value="Quintana Roo">Quintana Roo</option>
            <option value="San Luis Potosí">San Luis Potosí</option>
            <option value="Sinaloa">Sinaloa</option>
            <option value="Sonora">Sonora</option>
            <option value="Tabasco">Tabasco</option>
            <option value="Tamaulipas">Tamaulipas</option>
            <option value="Tlaxcala">Tlaxcala</option>
            <option value="Veracruz">Veracruz</option>
            <option value="Yucatán">Yucatán</option>
            <option value="Zacatecas">Zacatecas</option>
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label" for="city">Ciudad</label>
          <input type="text" id="city" name="city" class="form-control" placeholder="Ciudad" autocomplete="address-level2">
        </div>

        <div class="col-md-6">
          <label class="form-label" for="zipCode">Código Postal</label>
          <input type="text" id="zipCode" name="zipCode" class="form-control" placeholder="00000" maxlength="5" autocomplete="postal-code">
        </div>

        <!-- Gestión de Contraseña -->
        <div class="col-12 mt-4">
          <h5 class="profile-section-title">
            <i class="fas fa-key me-2"></i>Gestión de Contraseña
          </h5>
        </div>

        <div class="col-md-6">
          <label class="form-label">Contraseña actual</label>
          <div class="input-group">
            <input type="password" id="currentPassword" class="form-control" placeholder="••••••••" readonly>
            <button class="btn btn-outline-secondary" type="button" id="toggleCurrentPassword">
              <i class="fas fa-eye" id="currentPasswordIcon"></i>
            </button>
          </div>
          <small class="text-muted">Tu contraseña actual está protegida</small>
        </div>

        <div class="col-md-6">
          <label class="form-label">Contraseña nueva (opcional)</label>
          <div class="input-group">
            <input type="password" id="newPassword" class="form-control" autocomplete="new-password" placeholder="••••••••" minlength="6">
            <button class="btn btn-outline-secondary" type="button" id="toggleNewPassword">
              <i class="fas fa-eye" id="newPasswordIcon"></i>
            </button>
          </div>
          <small class="text-muted">Mínimo 6 caracteres. Déjalo vacío si no deseas cambiarla.</small>
        </div>

        <div class="col-12 text-center mt-4">
          <button type="submit" class="btn btn-purple" id="saveProfileBtn">
            <i class="fas fa-save me-2"></i>
            <span id="saveProfileText">Actualizar perfil</span>
            <span id="saveProfileSpinner" class="spinner-border spinner-border-sm d-none ms-2"></span>
          </button>
          <a href="two-factor.html" class="btn btn-outline-purple ms-2">
            <i class="fas fa-shield-alt me-2"></i>
            Configurar 2FA
          </a>
        </div>
      </div>
    </form>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (Toast support) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" async></script>

  <!-- Toast container -->
  <div class="position-fixed bottom-0 end-0 p-3 profile-toast-container">
    <div id="toast" class="toast text-white" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3500">
      <div class="toast-body"></div>
    </div>
  </div>

  <script src="env.js" async></script>
  
  <!-- Auth Guard - Protección de rutas -->
  <script type="module" src="auth-guard.js" async></script>
  <!-- Script para funciones de contraseña -->
  <script type="module" src="../src/pages/donationcenter-profile.js" async></script>
  <script type="module" src="../src/pages/profile.js" async></script>
  <script type="module" src="../src/utils/auth.js" async></script>

</body>
</html>



