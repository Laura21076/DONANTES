<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        script-src 'self' 'unsafe-eval' 'wasm-unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://www.gstatic.com https://firebase.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com chrome-extension:;
        style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
        img-src 'self' data: https: blob: firebasestorage.googleapis.com *.firebasestorage.app *.googleapis.com *.gstatic.com;
        connect-src 'self' http://localhost:4000 http://127.0.0.1:4000 https: wss: firebasestorage.googleapis.com *.googleapis.com *.firebasestorage.app;
        worker-src 'self' blob:;
        manifest-src 'self';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
        default-src 'self';"
    />
    <title>Sistema 2FA - DONANTES</title>
    <link rel="icon" type="image/x-icon" href="assets/logo.ico">
    <link rel="shortcut icon" type="image/x-icon" href="assets/logo.ico">
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Moirai+One&family=Rubik:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Project Styles -->
    <link rel="stylesheet" href="../src/styles/styles.css">
    <link rel="stylesheet" href="../src/styles/two-factor.css">
    
    <!-- Environment Config -->
    <script src="env.js"></script>
    <script src="sw-register.js"></script>
</head>
    
<body>

<!-- NAVBAR - Matching donationcenter.html style -->
<nav class="navbar navbar-expand-lg navbar-light donationcenter-navbar fixed-top" style="z-index: 1030;">
  <div class="container-fluid">
    <a class="navbar-brand donationcenter-brand" href="donationcenter.html">
      <i class="fas fa-heart heart-icon"></i> DONANTES
    </a>
    <div class="ms-auto d-flex align-items-center gap-3">
      <a href="donationcenter.html" class="btn btn-purple btn-sm">
        <i class="fas fa-arrow-left me-1"></i> Volver
      </a>
    </div>
  </div>
</nav>

<!-- Spacer for fixed navbar -->
<div style="height: 80px;"></div>

<!-- CONTENIDO PRINCIPAL -->
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <!-- ENCABEZADO DE SEGURIDAD -->
            <div class="security-header text-center rounded-top">
                <i class="fas fa-shield-alt security-icon"></i>
                <h1 class="page-title">Autenticación de Dos Factores</h1>
                <p class="page-subtitle mb-0">
                    Protege tu cuenta con una capa adicional de seguridad
                </p>
            </div>

            <!-- CARD PRINCIPAL -->
            <div class="main-card">
              <div class="card-body p-4">
                <div class="text-center mb-4">
                  <i class="fas fa-shield-alt text-purple-light" style="font-size: 3rem;"></i>
                  <h2 class="mt-2 text-purple-primary">Autenticación en Dos Pasos</h2>
                  <p class="lead">Protege tu cuenta con un código de 6 dígitos enviado a tu correo electrónico.</p>
                </div>
                
                <!-- Estado Actual -->
                <div id="statusSection" class="status-card">
                  <h5 class="section-header">
                    <i class="fas fa-info-circle"></i> Estado Actual
                  </h5>
                  <div id="statusDisplay" class="alert alert-info-custom">
                    <i class="fas fa-spinner fa-spin me-2"></i> Verificando estado del sistema 2FA...
                  </div>
                </div>
                
                <!-- Sección de Configuración -->
                <div id="setupSection" class="status-card section-hidden">
                  <h5 class="section-header">
                    <i class="fas fa-envelope"></i> Configurar 2FA por Email
                  </h5>
                  <div class="alert alert-warning-custom mb-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Importante:</strong> Recibirás un código de 6 dígitos en tu correo electrónico registrado.
                  </div>
                  <button id="setupBtn" class="btn btn-purple btn-security">
                    <i class="fas fa-shield-alt me-2"></i> Enviar Código de Activación
                  </button>
                </div>
                
                <!-- Sección de Verificación -->
                <div id="qrSection" class="status-card section-hidden">
                  <h5 class="section-header">
                    <i class="fas fa-key"></i> Verifica tu Código
                  </h5>
                  <div class="row align-items-end">
                    <div class="col-md-8 mb-2 mb-md-0">
                      <label for="verificationCode" class="form-label verification-label">Código de 6 dígitos</label>
                      <input type="text" id="verificationCode" class="form-control" placeholder="Ingresa el código de 6 dígitos" maxlength="6">
                    </div>
                    <div class="col-md-4">
                      <button id="verifySetupBtn" class="btn btn-success-custom btn-security w-100">
                        <i class="fas fa-check me-2"></i> Verificar y Activar
                      </button>
                    </div>
                  </div>
                </div>
                
                <!-- Sección de Códigos de Respaldo -->
                <div id="backupSection" class="status-card section-hidden">
                  <h5 class="section-header">
                    <i class="fas fa-key"></i> Códigos de Respaldo
                  </h5>
                  <div class="alert alert-warning-custom mb-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Importante:</strong> Guarda estos códigos en un lugar seguro. Cada código solo puede usarse una vez.
                  </div>
                  <div id="backupCodes"></div>
                </div>
                
                <!-- Sección para Deshabilitar -->
                <div id="disableSection" class="status-card section-hidden">
                  <h5 class="section-header">
                    <i class="fas fa-lock-open"></i> Deshabilitar 2FA
                  </h5>
                  <div class="row align-items-end">
                    <div class="col-md-8 mb-2 mb-md-0">
                      <label for="disableCode" class="form-label verification-label">Código de verificación</label>
                      <input type="text" id="disableCode" class="form-control" placeholder="Ingresa tu código" maxlength="6">
                    </div>
                    <div class="col-md-4">
                      <button id="disableBtn" class="btn btn-danger-custom btn-security w-100">
                        <i class="fas fa-lock-open me-2"></i> Deshabilitar
                      </button>
                    </div>
                  </div>
                </div>
                
                <!-- Sección para Regenerar Códigos -->
                <div id="regenerateSection" class="status-card section-hidden">
                  <h5 class="section-header">
                    <i class="fas fa-redo"></i> Regenerar Códigos de Respaldo
                  </h5>
                  <div class="row align-items-end">
                    <div class="col-md-8 mb-2 mb-md-0">
                      <label for="regenerateCode" class="form-label verification-label">Código de verificación</label>
                      <input type="text" id="regenerateCode" class="form-control" placeholder="Ingresa tu código" maxlength="6">
                    </div>
                    <div class="col-md-4">
                      <button id="regenerateBtn" class="btn btn-info-custom btn-security w-100">
                        <i class="fas fa-redo me-2"></i> Regenerar
                      </button>
                    </div>
                  </div>
                </div>

                <!-- FOOTER DE LA CARD -->
                <div class="card-footer-custom">
                    <i class="fas fa-shield-alt me-2"></i>
                    Protegido por el Sistema de Seguridad <span class="brand-text">DONANTES</span>
                </div>
              </div>
            </div>

            <!-- BOTÓN PARA VOLVER -->
            <div class="text-center mt-4">
                <a href="donationcenter.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i> Volver al Centro de Donaciones
                </a>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script type="module" src="../src/utils/notifications-init.js"></script>
<script type="module" src="../src/utils/auth-guard.js"></script>
<script type="module" src="../src/utils/two-factor-init.js"></script>
</body>
</html>

