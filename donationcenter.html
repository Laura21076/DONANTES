<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSP Mejorada -->
  <meta http-equiv="Content-Security-Policy" content="
      script-src 'self' 'unsafe-eval' 'wasm-unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://www.gstatic.com https://firebase.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com https://maps.googleapis.com https://www.googletagmanager.com chrome-extension:;
      style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com;
      font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
      img-src 'self' data: https: blob: firebasestorage.googleapis.com *.firebasestorage.app *.googleapis.com *.gstatic.com;
      connect-src 'self' http://localhost:4000 http://127.0.0.1:4000 https: wss: firebasestorage.googleapis.com *.googleapis.com *.firebasestorage.app;
      worker-src 'self' blob:;
      manifest-src 'self';
      object-src 'none';
      base-uri 'self';
      form-action 'self';
      default-src 'self';"
  />

  <title>Centro de Donaciones | Donantes</title>
  <link rel="icon" href="assets/logo.ico" type="image/x-icon">
  <link rel="shortcut icon" href="assets/logo.ico" type="image/x-icon">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;700&family=Moirai+One&display=swap" rel="stylesheet">

  <!-- Tu CSS principal personalizado -->
    <link rel="stylesheet" href="donationcenter.css">

  <!-- Config JS (siempre antes de los módulos principales) -->
    <script src="env.js"></script>
    <script type="module" src="auth-guard.js"></script>
    <script src="sw-register.js"></script>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#A992D8">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
</head>

<body>
 <!-- NAVBAR -->
 <nav class="navbar navbar-expand-lg navbar-light donationcenter-navbar fixed-top" style="z-index: 1030;">
   <div class="container-fluid">
     <a class="navbar-brand donationcenter-brand" href="#">
       <i class="fas fa-heart heart-icon"></i> DONANTES
     </a>
     <div class="ms-auto d-flex align-items-center gap-3">
       <a href="requests.html" class="btn btn-outline-primary rounded-pill px-3 py-1 shadow-sm d-flex align-items-center gap-2" style="font-weight: 500;">
         <i class="fa-solid fa-inbox"></i>
         Solicitudes
       </a>
       <div class="dropdown">
         <a href="#" id="profileDropdown" class="d-flex align-items-center text-decoration-none" data-bs-toggle="dropdown" aria-expanded="false">
           <i id="profileIcon" class="fa-regular fa-circle-user fa-2x profile-icon"></i>
         </a>
         <ul class="dropdown-menu dropdown-menu-end mt-2 shadow-sm" aria-labelledby="profileDropdown">
           <li>
             <a class="dropdown-item d-flex align-items-center gap-2" href="donationcenter-profile.html" title="Perfil">
               <i class="fas fa-user text-purple"></i> Perfil
             </a>
           </li>
           <li>
             <a class="dropdown-item" href="two-factor.html">
               <i class="fas fa-shield-alt me-2 text-purple"></i> Autenticación 2FA
             </a>
           </li>
           <li class="admin-only" style="display: none;">
             <hr class="dropdown-divider">
           </li>
           <li class="admin-only" style="display: none;">
             <a class="dropdown-item" href="dashboard.html">
               <i class="fas fa-crown me-2 text-purple"></i> Panel Administrador
             </a>
           </li>
           <li class="admin-only" style="display: none;">
             <a class="dropdown-item" href="security.html">
               <i class="fas fa-cog me-2 text-purple"></i> Centro de Seguridad (Admin)
             </a>
           </li>
           <li><hr class="dropdown-divider"></li>
           <li>
             <a class="dropdown-item logout" href="#" id="logoutBtn">
               <i class="fas fa-heart me-2 heart-icon text-purple"></i> Cerrar sesión
             </a>
           </li>
         </ul>
       </div>
     </div>
   </div>
 </nav>

 <!-- Spacer for fixed navbar -->
 <div style="height: 80px;"></div>

 <!-- CONTENIDO PRINCIPAL -->
 <div class="container my-5">
   <h2 class="text-center mb-4 donationcenter-title">Artículos publicados</h2>
   <div id="feedbackMessage"></div>
   <div id="articlesGrid" class="row g-4"></div>
   <div id="emptyState" class="text-center py-5 empty-state">
     <i class="fas fa-box-open fa-4x mb-3 empty-icon text-purple"></i>
     <h4 class="empty-title">No hay artículos publicados</h4>
     <p class="empty-text">Sé el primero en publicar un artículo para donar</p>
   </div>
 </div>

 <!-- BOTÓN FLOTANTE -->
 <button class="btn-float" data-bs-toggle="modal" data-bs-target="#uploadModal">+</button>

 <!-- MODAL PARA PUBLICAR/EDITAR ARTÍCULO -->
 <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
   <div class="modal-dialog modal-dialog-centered">
     <div class="modal-content p-3">
       <div class="modal-header">
         <h5 class="modal-title" id="uploadModalLabel">Publicar artículo</h5>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
       </div>
       <div class="modal-body">
         <form id="uploadForm" class="needs-validation" novalidate>
           <input type="hidden" id="articleId">
           <div class="mb-3">
             <label for="articleName" class="form-label modal-form-label">Nombre del artículo *</label>
             <input type="text" class="form-control" id="articleName" required>
             <div class="invalid-feedback">Por favor, ingresa el nombre del artículo.</div>
           </div>
           <div class="mb-3">
             <label for="articleDescription" class="form-label modal-form-label">Descripción *</label>
             <textarea class="form-control" id="articleDescription" rows="3" required></textarea>
             <div class="invalid-feedback">Agrega una breve descripción.</div>
           </div>
           <div class="mb-3">
             <label for="articleCategory" class="form-label modal-form-label">Categoría</label>
             <select class="form-control" id="articleCategory">
               <option value="general">General</option>
               <option value="ropa">Ropa</option>
               <option value="electronica">Electrónica</option>
               <option value="muebles">Muebles</option>
               <option value="libros">Libros</option>
               <option value="juguetes">Juguetes</option>
               <option value="otros">Otros</option>
             </select>
           </div>
           <div class="mb-3">
             <label for="articleCondition" class="form-label">Condición</label>
             <select class="form-control" id="articleCondition">
               <option value="nuevo">Nuevo</option>
               <option value="como_nuevo">Como nuevo</option>
               <option value="bueno">Bueno</option>
               <option value="usado">Usado</option>
             </select>
           </div>
           <div class="mb-3">
             <label for="articleImageFile" class="form-label">Imagen del artículo</label>
             <input type="file" class="form-control" id="articleImageFile" accept="image/*">
             <div class="form-text">Puedes subir una imagen (recomendado). Opcionalmente, pega una URL abajo.</div>
             <input type="url" class="form-control mt-2" id="articleImageUrl" placeholder="o pega aquí una URL de imagen (opcional)">
             <div class="mt-2 article-image-preview" id="articleImagePreview">
               <img id="articleImagePreviewImg" alt="Vista previa" class="img-fluid rounded border article-preview-img" />
             </div>
           </div>
           <div class="mb-3">
             <label for="articleLocation" class="form-label">Ubicación</label>
             <input type="text" class="form-control" id="articleLocation" placeholder="Ciudad, Estado">
           </div>
           <button type="submit" class="btn btn-purple w-100" id="submitBtn">Publicar artículo</button>
         </form>
       </div>
     </div>
   </div>
 </div>

 <!-- MODAL CONFIRMACIÓN ELIMINAR ARTÍCULO -->
 <div class="modal fade" id="deleteArticleModal" tabindex="-1" aria-labelledby="deleteArticleModalLabel" aria-hidden="true">
   <div class="modal-dialog modal-dialog-centered">
     <div class="modal-content">
       <div class="modal-header bg-danger text-white">
         <h5 class="modal-title" id="deleteArticleModalLabel"><i class="fas fa-trash-alt me-2"></i>Eliminar artículo</h5>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
       </div>
       <div class="modal-body">
         <p>¿Estás seguro de que deseas eliminar este artículo? Esta acción no se puede deshacer.</p>
       </div>
       <div class="modal-footer">
         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
         <button type="button" class="btn btn-danger" id="confirmDeleteArticleBtn">Eliminar</button>
       </div>
     </div>
   </div>
 </div>

 <!-- Toast container -->
 <div class="position-fixed bottom-0 end-0 p-3 donation-toast">
   <div id="toast" class="toast text-white" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3500">
     <div class="toast-body"></div>
   </div>
 </div>

 <!-- Bootstrap, tu JS y logout-btn.js -->
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
 <script type="module" src="donationcenter.js"></script>
 <script type="module" src="donation-center-init.js"></script>
 <script type="module" src="logout-btn.js"></script>
 <script type="module" src="google-maps-handler.js"></script>
 <script type="module" src="auth.js"></script>
 <script type="module" src="locker.js"></script> 

 <!-- Google Maps API -->
 <script
   src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUNKWZLeNkmUsxWVnKAiPHBexUPjFL02A&libraries=places"
   id="google-maps-script"
   async
   defer>
 </script>
</body>
</html>


