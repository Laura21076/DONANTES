<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    script-src 'self' 'unsafe-eval' 'unsafe-inline' 'unsafe-hashes' 'wasm-unsafe-eval' 'sha256-kPx0AsF0oz2kKiZ875xSvv693TBHkQ/0SkMJZnnNpnQ=' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://www.gstatic.com https://firebase.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com https://maps.googleapis.com https://www.googletagmanager.com chrome-extension:;
    style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
    img-src 'self' data: https: blob: firebasestorage.googleapis.com *.firebasestorage.app *.googleapis.com *.gstatic.com;
    connect-src 'self' http://localhost:4000 http://127.0.0.1:4000 https: wss: firebasestorage.googleapis.com *.googleapis.com *.firebasestorage.app;
    worker-src 'self' blob:;
    manifest-src 'self';
    object-src 'none';
    base-uri 'self';
    form-action 'self';
    default-src 'self';"
  />
  <title>Centro de Donaciones | Donantes</title>
  <link rel="icon" href="../assets/logo.ico" type="image/x-icon">
  <link rel="shortcut icon" href="../assets/logo.ico" type="image/x-icon">
  
  <!-- Preload critical resources -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" as="style">
  <link rel="preload" href="styles.css" as="style">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" as="style">
  <link rel="preload" href="env.js" as="script">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;700&family=Moirai+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  
  <!-- Config cargado de forma s칤ncrona para evitar delays -->
  <script src="env.js"></script>
  
  <!-- Auth Guard - Protecci칩n de rutas -->
  <script type="module" src="auth-guard.js"></script>
  <!-- Registro global de Service Worker -->
  <script src="sw-register.js"></script>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href= "manifest.json">
  <meta name="theme-color" content="#A992D8">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script type="module" src="test-notification.js"></script>
  
</head>

<body>

 <!-- 游댳 NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light donationcenter-navbar fixed-top" style="z-index: 1030;">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold text-purple donationcenter-brand">
      <i class="fas fa-heart heart-icon"></i> DONANTES
    </a>

    <div class="ms-auto d-flex align-items-center gap-3">
      <a href="requests.html" class="btn btn-purple btn-sm">
        Solicitudes
      </a>
      
      <div class="dropdown">
        <a href="#" id="profileDropdown" class="d-flex align-items-center text-decoration-none" data-bs-toggle="dropdown" aria-expanded="false">
          <i id="profileIcon" class="fa-regular fa-circle-user fa-2x text-purple profile-icon"></i>
        </a>
        <ul class="dropdown-menu dropdown-menu-end mt-2 shadow-sm" aria-labelledby="profileDropdown">
          <li>
            <a class="dropdown-item d-flex align-items-center gap-2" href="donationcenter-profile.html" title="Perfil">
              <i class="fas fa-arrow-left text-purple"></i>
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="security.html">
              <i class="fas fa-shield-alt me-2 text-purple"></i> Seguridad y 2FA
            </a>
          </li>
          <!-- Dashboard de Administrador (solo visible para admins) -->
          <li class="admin-only" style="display: none;">
            <hr class="dropdown-divider">
          </li>
          <li class="admin-only" style="display: none;">
            <a class="dropdown-item" href="dashboard.html">
              <i class="fas fa-crown me-2 text-purple"></i> Panel Administrador
            </a>
          </li>
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item logout" href="login.html">
              <i class="fas fa-heart me-2 heart-icon text-purple"></i> Cerrar sesi칩n
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- Spacer for fixed navbar -->
<div style="height: 80px;"></div>


  <!-- 游댳 CONTENIDO -->
  <div class="container my-5">
    <h2 class="text-center mb-4 donationcenter-title">Art칤culos publicados</h2>
    
    <!-- Mensaje de feedback -->
    <div id="feedbackMessage"></div>
    
    <!-- Grid de art칤culos -->
    <div id="articlesGrid" class="row g-4">
      <!-- Los art칤culos se cargar치n din치micamente aqu칤 -->
    </div>
    
    <!-- Mensaje cuando no hay art칤culos -->
    <div id="emptyState" class="text-center py-5 empty-state">
      <i class="fas fa-box-open fa-4x mb-3 empty-icon text-purple"></i>
      <h4 class="empty-title">No hay art칤culos publicados</h4>
      <p class="empty-text">S칠 el primero en publicar un art칤culo para donar</p>
    </div>
  </div>

  <!-- 游댳 BOT칍N FLOTANTE -->
  <button class="btn-float" data-bs-toggle="modal" data-bs-target="#uploadModal">+</button>

  <!-- 游댳 MODAL PARA PUBLICAR/EDITAR ART칈CULO -->
  <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadModalLabel">Publicar art칤culo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <form id="uploadForm" class="needs-validation" novalidate>
            <input type="hidden" id="articleId">
            
            <div class="mb-3">
              <label for="articleName" class="form-label modal-form-label">Nombre del art칤culo *</label>
              <input type="text" class="form-control" id="articleName" required>
              <div class="invalid-feedback">Por favor, ingresa el nombre del art칤culo.</div>
            </div>
            
            <div class="mb-3">
              <label for="articleDescription" class="form-label modal-form-label">Descripci칩n *</label>
              <textarea class="form-control" id="articleDescription" rows="3" required></textarea>
              <div class="invalid-feedback">Agrega una breve descripci칩n.</div>
            </div>
            
            <div class="mb-3">
              <label for="articleCategory" class="form-label modal-form-label">Categor칤a</label>
              <select class="form-control" id="articleCategory">
                <option value="general">General</option>
                <option value="ropa">Ropa</option>
                <option value="electronica">Electr칩nica</option>
                <option value="muebles">Muebles</option>
                <option value="libros">Libros</option>
                <option value="juguetes">Juguetes</option>
                <option value="otros">Otros</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="articleCondition" class="form-label">Condici칩n</label>
              <select class="form-control" id="articleCondition">
                <option value="nuevo">Nuevo</option>
                <option value="como_nuevo">Como nuevo</option>
                <option value="bueno">Bueno</option>
                <option value="usado">Usado</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="articleImageFile" class="form-label">Imagen del art칤culo</label>
              <input type="file" class="form-control" id="articleImageFile" accept="image/*">
              <div class="form-text">Puedes subir una imagen (recomendado). Opcionalmente, pega una URL abajo.</div>
              <input type="url" class="form-control mt-2" id="articleImageUrl" placeholder="o pega aqu칤 una URL de imagen (opcional)">
              <div class="mt-2 article-image-preview" id="articleImagePreview">
                <img id="articleImagePreviewImg" alt="Vista previa" class="img-fluid rounded border article-preview-img" />
              </div>
            </div>
            
            <div class="mb-3">
              <label for="articleLocation" class="form-label">Ubicaci칩n</label>
              <input type="text" class="form-control" id="articleLocation" placeholder="Ciudad, Estado">
            </div>
            
            <button type="submit" class="btn btn-purple w-100" id="submitBtn">Publicar art칤culo</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- 游댳 MODAL CONFIRMACI칍N ELIMINAR ART칈CULO -->
  <div class="modal fade" id="deleteArticleModal" tabindex="-1" aria-labelledby="deleteArticleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="deleteArticleModalLabel"><i class="fas fa-trash-alt me-2"></i>Eliminar art칤culo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <p>쮼st치s seguro de que deseas eliminar este art칤culo? Esta acci칩n no se puede deshacer.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteArticleBtn">Eliminar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="notifications.js"></script>
  <script type="module" src="notifications-init.js"></script>
  <script type="module" src="session-manager.js"></script>
  <script type="module" src="donationcenter.js"></script>

  <!-- Script de diagn칩stico de autenticaci칩n -->
  <script type="module" src="diagnostico-auth.js"></script>
  <script type="module" src="donation-center-init.js"></script>

  <!-- Toast container -->
  <div class="position-fixed bottom-0 end-0 p-3 donation-toast">
    <div id="toast" class="toast text-white" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3500">
      <div class="toast-body"></div>
    </div>
  </div>

  <!-- Google Maps API -->
  <script async defer 
                  <button id="testNotificationBtn" class="btn btn-outline-purple position-fixed" style="bottom: 1rem; right: 1rem; z-index: 9999;">
                    Probar notificaci칩n
                  </button>
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUNKWZLeNkmUsxWVnKAiPHBexUPjFL02A&libraries=places"
    id="google-maps-script">
  </script>
  
  <!-- Manejo de Google Maps sin script inline -->
  <script type="module" src="google-maps-handler.js"></script>

  </body>
</html>

